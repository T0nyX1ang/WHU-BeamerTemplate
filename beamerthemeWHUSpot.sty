% beamerthemeWHUSpot.sty v1.0 2019/06/11
% A beamer theme based on the spots in Wuhan University
% Author: Tony Xiang

\mode<presentation>

\ProvidesPackage{beamerthemeWHUSpot}
\RequirePackage{tikz}
\usetikzlibrary{calc}
\RequirePackage{cncolours}
\RequirePackage{pgfmath}

\usefonttheme[onlymath]{serif}

\setbeamercolor{normal text}{fg=black}
\setbeamercolor{alerted text}{fg=酡红}
\setbeamercolor{example text}{fg=宝蓝}
\setbeamercolor{titlelike}{fg=black}
\setbeamercolor{frametitle}{fg=white,bg=海棠红}
\setbeamercolor{qed symbol}{fg=松花色}
\setbeamercolor{button}{fg=white,bg=松花色}
\setbeamercolor{block title}{fg=宝蓝}
\setbeamercolor{block title alerted}{fg=酡红}
\setbeamercolor{block title example}{fg=宝蓝}
\setbeamercolor{itemize item}{fg=宝蓝}
\setbeamercolor{itemize subitem}{fg=宝蓝}
\setbeamercolor{itemize subsubitem}{fg=宝蓝}
\setbeamercolor{enumerate item}{fg=宝蓝}
\setbeamercolor{enumerate subitem}{fg=宝蓝}
\setbeamercolor{enumerate subsubitem}{fg=宝蓝}

\input{./models/building.tex}
\input{./models/sakura.tex}
\input{./models/petal.tex}

\def\progressbar{
    % draw a vertical progress bar here
    \begin{tikzpicture}
        % construct several paths to make room for the sakura
        \path (-0.5cm, 0) -- (0.5cm, 0);
        \draw[pink!80!white, line width=0.4pt] (0, 0) -- (0, -0.8\paperheight);
        \pgfmathparse{-0.8 / \inserttotalframenumber * \paperheight * (\insertframenumber - 0.5)} % calculate the required shift
        \begin{scope}[yshift=\pgfmathresult, scale=.05]
            \drawsakura{嫣红}{樱桃色}{樱草色}{53}{-25}{0.25}{3.75}
        \end{scope}
        \node[rounded corners, fill=gray, draw=gray, text width=4.5em, align=center, inner sep=2pt, text=white, anchor=east] at (0.405, -0.8\paperheight-5) %rounded rectangle west arc=none
        {
            \insertframenumber\ /\ \inserttotalframenumber
        };
    \end{tikzpicture}
}

\AtBeginSection[] % Do nothing for \section*
{
    \sectionpage
}

\AtBeginSection[*] % Do nothing for \section*
{
    \sectionpage
}

\setbeamertemplate{frametitle}[shadow theme]
\setbeamersize{sidebar width left=1cm}
\setbeamertemplate{sidebar left}
{
    \includegraphics[width=1cm,height=1cm]{./logos/whulogoblack.eps} \\
    \progressbar
}
\setbeamertemplate{background canvas}{%
    \begin{tikzpicture}[scale=.4,opacity=.85]
        \useasboundingbox (-17.3, 2.5) rectangle (24.3, 17.5);
        \drawbuilding{霜色}
    \end{tikzpicture}
}
\setbeamertemplate{navigation symbols}{}
\setbeamertemplate{section page}
{
    \begingroup 
        \setbeamertemplate{background canvas}
        {
            \begin{tikzpicture}
                \fill[color=海棠红] (0, 0) rectangle (\paperwidth, \paperheight);
            \end{tikzpicture}
        }
        \begin{frame}[c, plain]
            \vskip 1.2em
            \textcolor{white}{\insertsection}
            \vskip 0.3em
            \hskip 0.1em
            % draw a horizontal progress bar here
            \begin{tikzpicture}
                \draw[line width=0.1pt, color=霜色] (0, 0) -- (.8\paperheight, 0);
                \pgfmathparse{0.8 / \inserttotalframenumber * \paperheight * (\insertframenumber - 0.5)} % calculate the required shift
                \begin{scope}[xshift=\pgfmathresult, scale=.05]
                    \drawsakura{pink!10!white}{white}{樱草色}{53}{-25}{0.25}{3.75}
                \end{scope}
            \end{tikzpicture}
        \end{frame}
    \endgroup
}

\mode
<all>