% beamerthemeWHUSpot.sty v1.0 2019/06/11
% A beamer theme based on the spots in Wuhan University
% Author: Tony Xiang

\mode<presentation>

\ProvidesPackage{beamerthemeWHUSpot}
\RequirePackage{tikz}
\usetikzlibrary{calc}
\RequirePackage{cncolours}
\RequirePackage{pgfmath}

\usefonttheme[onlymath]{serif}

\setbeamercolor{normal text}{fg=black}
\setbeamercolor{alerted text}{fg=酡红}
\setbeamercolor{example text}{fg=宝蓝}
\setbeamercolor{titlelike}{fg=black}
\setbeamercolor{frametitle}{fg=white,bg=海棠红}
\setbeamercolor{qed symbol}{fg=松花色}
\setbeamercolor{button}{fg=white,bg=松花色}
\setbeamercolor{block title}{fg=宝蓝}
\setbeamercolor{block title alerted}{fg=酡红}
\setbeamercolor{block title example}{fg=宝蓝}
\setbeamercolor{itemize item}{fg=宝蓝}
\setbeamercolor{itemize subitem}{fg=宝蓝}
\setbeamercolor{itemize subsubitem}{fg=宝蓝}
\setbeamercolor{enumerate item}{fg=宝蓝}
\setbeamercolor{enumerate subitem}{fg=宝蓝}
\setbeamercolor{enumerate subsubitem}{fg=宝蓝}

\def\buildingcolor{霜色}
\def\buildingmodel{%
    \fill[\buildingcolor] (-1, 0) rectangle (1, 2);
    \draw[\buildingcolor] (-1.2, 0) rectangle (1.2, 2.2);
    \draw[line width=2.5pt,\buildingcolor] (-6, 0) -- (6, 0);
    \foreach \x in {1,...,5}
    {
        \draw[line width=1.5pt, \buildingcolor] (-4.5 - \x * 0.2, -\x / 3) -- (4.5 + \x * 0.2, -\x / 3);
    }
    \fill[\buildingcolor] (-12, -2) -- (12, -2) -- (11.5, -2.2) -- (-11.5, -2.2) -- cycle;
    \fill[\buildingcolor] (-11.3, -2.28) -- (11.3, -2.28) -- (10.8, -2.48) -- (-10.8, -2.48) -- cycle;
    \fill[\buildingcolor] (-6, -2.56) -- (6, -2.56) -- (5.5, -2.76) -- (-5.5, -2.76) -- cycle;

    \foreach \i in {-1, 1} 
        \filldraw[\buildingcolor] (-5.8 * \i, 0) -- (-5.8 * \i, -0.3) -- (-5.5 * \i, -0.3) -- (-6.4 * \i, -1.8) -- (-11.4 * \i, -1.8) -- (-10.68 * \i, -0.6) -- (-10.5 * \i, -0.6) -- (-10.5 * \i, 3.5) -- (-6 * \i, 3.5) -- (-6 * \i, 0) -- cycle;
    \foreach \j in {8.97, 7.72, 6.47}
        \filldraw[rounded corners, white] (\j, 2.4) rectangle (\j+ 1, 3);
    \foreach \j in {-8.97, -7.72, -6.47}
        \filldraw[rounded corners, white] (\j, 2.4) rectangle (\j- 1, 3);

    \filldraw[\buildingcolor] (-10.5, 3.9) rectangle (10.5, 4.6);
    \filldraw[\buildingcolor] (-10.5, 3.5) rectangle (10.5, 3.7);
    \foreach \k in {-5.6, -3.1, 3.5}
        \filldraw[\buildingcolor] (\k, 0) -- (\k, 3.9) -- (\k + 0.5, 3.9) -- (\k + 0.5, 3.5) -- (\k + 0.2, 3.3) -- (\k + 0.2, 0) -- cycle;
    \foreach \k in {5.6, 3.1, -3.5}
        \filldraw[\buildingcolor] (\k, 0) -- (\k, 3.9) -- (\k - 0.5, 3.9) -- (\k - 0.5, 3.5) -- (\k - 0.2, 3.3) -- (\k - 0.2, 0) -- cycle;
    \filldraw[\buildingcolor] (-0.25, 3.7) rectangle (0.25, 4);

    \filldraw[\buildingcolor] (-10.5, 4.8) [out=165,in=-78]to (-12.8, 7) [out=-75,in=-180]to (-10.8, 6) [out=0,in=-95]to (-8.9, 8) [out=-85,in=-180]to (-6.8, 5.9) [out=0,in=-120]to (-5, 6.8) [out=-95,in=15]to (-6, 5.0) -- (-6, 4.8) -- cycle; 
    \filldraw[\buildingcolor] (10.5, 4.8) [out=15,in=-102]to (12.8, 7) [out=-105,in=0]to (10.8, 6) [out=180,in=-85]to (8.9, 8) [out=-95,in=0]to (6.8, 5.9) [out=180,in=-60]to (5, 6.8) [out=-85,in=165]to (6, 5.0) -- (6, 4.8) -- cycle;
    \filldraw[\buildingcolor] (-6, 4.8) rectangle (6, 5.0);
    \foreach \i in {-1, 1}
    {
        \filldraw[\buildingcolor] (-8.4 * \i, 6.9) -- (-5.1 * \i, 6.9) -- (-5.3 * \i, 6.6) -- (-8.1 * \i, 6.6) -- cycle;
        \filldraw[\buildingcolor] (-7.99 * \i, 6.45) -- (-5.4 * \i, 6.45) -- (-5.52 * \i, 6.35) -- (-7.87 * \i, 6.35) -- cycle;		
    }
    \filldraw[\buildingcolor] (-4.88, 6.9) -- (4.88, 6.9) -- (4.9, 6.6) -- (-4.9, 6.6) -- cycle;
    \filldraw[\buildingcolor] (-4.93, 6.45) -- (4.93, 6.45) -- (4.95, 6.35) -- (-4.95, 6.35) -- cycle;e

    \foreach \i in {-1, 1}
    {
        \filldraw[\buildingcolor] (-5.5 * \i, 5.1) -- (-5.5 * \i, 5.2) -- (-5.3 * \i, 5.3) -- (-5.3 * \i, 5.1) -- cycle;
        \filldraw[\buildingcolor] (-5.2 * \i, 5.1) -- (-5.2 * \i, 5.35) -- (-5.05 * \i, 5.85) -- (-5.05 * \i, 5.1) -- cycle;
    }
    \foreach \i in {0,...,24}
        \filldraw[\buildingcolor] (-4.9 + \i * 0.4, 5.1) rectangle (-4.9 + \i * 0.4 + 0.2, 6.25);

    \filldraw[\buildingcolor] (-5, 7.7) [out=180,in=-90]to (-6.2, 8.5) [out=-30,in=-150]to (-4.4, 8.5) -- (-4.5, 9.6) to (-3.5, 8.8) -- (-2.7, 9.1) -- (-2.7, 10.2) -- (2.7, 10.2) -- (2.7, 9.1) -- (3.5, 8.8) to (4.5, 9.6) -- (4.4, 8.5) [out=-30,in=-150]to (6.2, 8.5) [out=-90,in=0]to (5, 7.7) -- (3.1, 8.2) -- (-3.1, 8.2) -- cycle;
    \filldraw[rounded corners=1pt,\buildingcolor] (-2.9, 10.0) rectangle (-2.5, 10.4);
    \filldraw[rounded corners=1pt,\buildingcolor] (2.9, 10.0) rectangle (2.5, 10.4);
    \foreach \i in {-1, 1}
        \filldraw[rounded corners=3pt,rotate around={13 * \i:(-4.7 * \i,7.1)},\buildingcolor] (-4.7 * \i, 7.1) rectangle (-3.1 * \i, 7.5); 
    \foreach \i in {0,...,3}
        \filldraw[rounded corners=3pt, \buildingcolor] (-2.95 + \i * 1.5, 7.5) rectangle (-1.55 + \i * 1.5, 7.9);

    \filldraw[\buildingcolor] (-0.3, 10.2) rectangle (0.3, 10.3);
    \filldraw[\buildingcolor] (-0.3, 10.4) [bend left=10]to (-0.3, 11.2) -- (-0.2, 11.3) -- (-0.3, 11.4) -- (-0.3, 11.6) -- (0.3, 11.6) -- (0.3, 11.4) -- (0.2, 11.3) -- (0.3, 11.2) [bend left=10]to (0.3, 10.4) -- cycle;
    \filldraw[\buildingcolor] (-0.2, 11.7) rectangle (0.2, 11.8);
}

\def\sakuraoutangle{53}
\def\sakurainangle{-25}
\def\sakuraxoffset{0.25}
\def\sakurayoffset{3.75}
\def\sakuraoutercolor{嫣红}
\def\sakurainnercolor{樱桃色}
\def\sakurafillcolor{嫣红}
\def\sakurakernelcolor{樱草色}
\def\sakuramodel{
	\foreach \x in {1,...,5}			
	{
		\filldraw[rotate=-(\x - 1) * 72,color=\sakuraoutercolor] (0,0) [out=\sakuraoutangle,in=\sakurainangle]to (\sakuraxoffset,\sakurayoffset) -- (0,\sakurayoffset-\sakuraxoffset) -- (-\sakuraxoffset,\sakurayoffset) [out=-180-\sakurainangle,in=180-\sakuraoutangle]to (0, 0) -- cycle;
		\fill[rotate=-(\x - 1) * 72-6,\sakurainnercolor,opacity=.65] (0,\sakurayoffset *0.25) circle (1.2pt);
		\fill[rotate=-(\x - 1) * 72+6,\sakurainnercolor,opacity=.65] (0,\sakurayoffset *0.25) circle (1.2pt);
		\fill[\sakurakernelcolor,opacity=.75] (0,0) circle (2.2pt);
	}
}

\def\progressbar{
	% draw a vertical progress bar here
	\begin{tikzpicture}
		% construct several paths to make room for the sakura
		\path (-0.5cm, 0) -- (0.5cm, 0);
		\draw[pink!80!white, line width=0.4pt] (0, 0) -- (0, -0.8\paperheight);
		\pgfmathparse{-0.8 / \inserttotalframenumber * \paperheight * (\insertframenumber - 0.5)} % calculate the required shift
		\begin{scope}[yshift=\pgfmathresult, scale=.05]
			\sakuramodel
		\end{scope}
		\node[rounded corners, fill=gray, draw=gray, text width=4.5em, align=center, inner sep=2pt, text=white, anchor=east] at (0.405, -0.8\paperheight-5) %rounded rectangle west arc=none
	    {
	    	\insertframenumber\ /\ \inserttotalframenumber
	    };
	\end{tikzpicture}
}

\AtBeginSection[] % Do nothing for \section*
{
	\sectionpage
}

\AtBeginSection[*] % Do nothing for \section*
{
	\sectionpage
}

\setbeamertemplate{frametitle}[shadow theme]
\setbeamersize{sidebar width left=1cm}
\setbeamertemplate{sidebar left}
{
	\includegraphics[width=1cm,height=1cm]{whulogoblack.eps} \\
	\progressbar
}
\setbeamertemplate{background canvas}{%
	\begin{tikzpicture}[scale=.4,opacity=.85]
	    \useasboundingbox (-17.3, 2.5) rectangle (24.3, 17.5);
	    \buildingmodel
	\end{tikzpicture}
}
\setbeamertemplate{navigation symbols}{}
\setbeamertemplate{section page}
{
	\begingroup 
		\setbeamertemplate{background canvas}
		{
			\begin{tikzpicture}
				\fill[color=海棠红] (0, 0) rectangle (\paperwidth, \paperheight);
			\end{tikzpicture}
		}
		\begin{frame}[c, plain]
			\vskip 1.2em
			\textcolor{white}{\insertsection}
			\vskip 0.3em
			\hskip 0.1em
			% draw a horizontal progress bar here
			\begin{tikzpicture}
				\draw[line width=0.1pt, color=霜色] (0, 0) -- (.8\paperheight, 0);
				\pgfmathparse{0.8 / \inserttotalframenumber * \paperheight * (\insertframenumber - 0.5)} % calculate the required shift
				\begin{scope}[xshift=\pgfmathresult, scale=.05]
					\renewcommand{\sakuraoutercolor}{pink!10!white}
					\renewcommand{\sakurainnercolor}{white}
					\renewcommand{\sakurafillcolor}{white}
					\sakuramodel
				\end{scope}
			\end{tikzpicture}
		\end{frame}
	\endgroup
}

\mode
<all>